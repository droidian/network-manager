From 6bf63e913c8246345167f937963c2c14da59ee23 Mon Sep 17 00:00:00 2001
From: Dan Williams <dcbw@redhat.com>
Date: Fri, 4 Mar 2011 23:52:44 -0600
Subject: [PATCH] dnsmasq: send no config file instead of a bogus one (lp:725041) (debian #615082)

---
 src/dnsmasq-manager/nm-dnsmasq-manager.c |   12 ++----------
 1 files changed, 2 insertions(+), 10 deletions(-)

Index: network-manager/src/dnsmasq-manager/nm-dnsmasq-manager.c
===================================================================
--- network-manager.orig/src/dnsmasq-manager/nm-dnsmasq-manager.c	2011-03-11 14:38:52.884832466 +0100
+++ network-manager/src/dnsmasq-manager/nm-dnsmasq-manager.c	2011-03-11 14:49:25.000832466 +0100
@@ -253,7 +253,6 @@
 	struct in_addr addr;
 	char buf[INET_ADDRSTRLEN + 15];
 	char localaddr[INET_ADDRSTRLEN + 1];
-	int i;
 
 	dm_binary = nm_find_dnsmasq ();
 	if (!dm_binary) {
@@ -277,17 +276,10 @@
 	/* dnsmasq may read from it's default config file location, which if that
 	 * location is a valid config file, it will combine with the options here
 	 * and cause undesirable side-effects.  Like sending bogus IP addresses
-	 * as the gateway or whatever.  So give dnsmasq a bogus config file
-	 * location to avoid screwing up the configuration we're passing to it.
+	 * as the gateway or whatever.  So tell dnsmasq not to use any config file
+	 * at all.
 	 */
-	memset (buf, 0, sizeof (buf));
-	strcpy (buf, "/tmp/");
-	for (i = 5; i < 15; i++)
-		buf[i] = (char) (g_random_int_range ((guint32) 'a', (guint32) 'z') & 0xFF);
-	strcat (buf, ".conf");
-
 	nm_cmd_line_add_string (cmd, "--conf-file");
-	nm_cmd_line_add_string (cmd, buf);
 
 	nm_cmd_line_add_string (cmd, "--no-hosts");
 	nm_cmd_line_add_string (cmd, "--keep-in-foreground");
